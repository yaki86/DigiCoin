{"ast":null,"code":"import { GraphQLApiError } from '../utils/errors/GraphQLApiError.mjs';\nimport '../utils/errors/validation.mjs';\nimport 'graphql';\nimport { NO_AUTH_TOKEN_HEADER, NO_SIGNED_IN_USER, NO_VALID_AUTH_TOKEN, NO_VALID_CREDENTIALS, NO_API_KEY } from '../utils/errors/constants.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nasync function headerBasedAuth(amplify, authMode, apiKey) {\n  let additionalHeaders = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  let headers = {};\n  switch (authMode) {\n    case 'apiKey':\n      if (!apiKey) {\n        throw new GraphQLApiError(NO_API_KEY);\n      }\n      headers = {\n        'X-Api-Key': apiKey\n      };\n      break;\n    case 'iam':\n      {\n        const session = await amplify.Auth.fetchAuthSession();\n        if (session.credentials === undefined) {\n          throw new GraphQLApiError(NO_VALID_CREDENTIALS);\n        }\n        break;\n      }\n    case 'oidc':\n    case 'userPool':\n      {\n        let token;\n        try {\n          token = (await amplify.Auth.fetchAuthSession()).tokens?.accessToken.toString();\n        } catch (e) {\n          // fetchAuthSession failed\n          throw new GraphQLApiError({\n            ...NO_SIGNED_IN_USER,\n            underlyingError: e\n          });\n        }\n        // `fetchAuthSession()` succeeded but didn't return `tokens`.\n        // This may happen when unauthenticated access is enabled and there is\n        // no user signed in.\n        if (!token) {\n          throw new GraphQLApiError(NO_VALID_AUTH_TOKEN);\n        }\n        headers = {\n          Authorization: token\n        };\n        break;\n      }\n    case 'lambda':\n      if (typeof additionalHeaders === 'object' && !additionalHeaders.Authorization) {\n        throw new GraphQLApiError(NO_AUTH_TOKEN_HEADER);\n      }\n      headers = {\n        Authorization: additionalHeaders.Authorization\n      };\n      break;\n  }\n  return headers;\n}\nexport { headerBasedAuth };","map":{"version":3,"names":["headerBasedAuth","amplify","authMode","apiKey","additionalHeaders","arguments","length","undefined","headers","GraphQLApiError","NO_API_KEY","session","Auth","fetchAuthSession","credentials","NO_VALID_CREDENTIALS","token","tokens","accessToken","toString","e","NO_SIGNED_IN_USER","underlyingError","NO_VALID_AUTH_TOKEN","Authorization","NO_AUTH_TOKEN_HEADER"],"sources":["/Users/yaki/digi-coin/digi-coin-app/node_modules/@aws-amplify/api-graphql/src/internals/graphqlAuth.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { GraphQLApiError } from '../utils/errors';\nimport { NO_API_KEY, NO_AUTH_TOKEN_HEADER, NO_SIGNED_IN_USER, NO_VALID_AUTH_TOKEN, NO_VALID_CREDENTIALS, } from '../utils/errors/constants';\nexport async function headerBasedAuth(amplify, authMode, apiKey, additionalHeaders = {}) {\n    let headers = {};\n    switch (authMode) {\n        case 'apiKey':\n            if (!apiKey) {\n                throw new GraphQLApiError(NO_API_KEY);\n            }\n            headers = {\n                'X-Api-Key': apiKey,\n            };\n            break;\n        case 'iam': {\n            const session = await amplify.Auth.fetchAuthSession();\n            if (session.credentials === undefined) {\n                throw new GraphQLApiError(NO_VALID_CREDENTIALS);\n            }\n            break;\n        }\n        case 'oidc':\n        case 'userPool': {\n            let token;\n            try {\n                token = (await amplify.Auth.fetchAuthSession()).tokens?.accessToken.toString();\n            }\n            catch (e) {\n                // fetchAuthSession failed\n                throw new GraphQLApiError({\n                    ...NO_SIGNED_IN_USER,\n                    underlyingError: e,\n                });\n            }\n            // `fetchAuthSession()` succeeded but didn't return `tokens`.\n            // This may happen when unauthenticated access is enabled and there is\n            // no user signed in.\n            if (!token) {\n                throw new GraphQLApiError(NO_VALID_AUTH_TOKEN);\n            }\n            headers = {\n                Authorization: token,\n            };\n            break;\n        }\n        case 'lambda':\n            if (typeof additionalHeaders === 'object' &&\n                !additionalHeaders.Authorization) {\n                throw new GraphQLApiError(NO_AUTH_TOKEN_HEADER);\n            }\n            headers = {\n                Authorization: additionalHeaders.Authorization,\n            };\n            break;\n        case 'none':\n            break;\n        default:\n            break;\n    }\n    return headers;\n}\n"],"mappings":";;;;;AAAA;AACA;AAGO,eAAeA,eAAeA,CAACC,OAAO,EAAEC,QAAQ,EAAEC,MAAM,EAA0B;EAAA,IAAxBC,iBAAiB,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EACnF,IAAIG,OAAO,GAAG,EAAE;EAChB,QAAQN,QAAQ;IACZ,KAAK,QAAQ;MACT,IAAI,CAACC,MAAM,EAAE;QACT,MAAM,IAAIM,eAAe,CAACC,UAAU,CAAC;MACrD;MACYF,OAAO,GAAG;QACN,WAAW,EAAEL;MAC7B,CAAa;MACD;IACJ,KAAK,KAAK;MAAE;QACR,MAAMQ,OAAO,GAAG,MAAMV,OAAO,CAACW,IAAI,CAACC,gBAAgB,EAAE;QACrD,IAAIF,OAAO,CAACG,WAAW,KAAKP,SAAS,EAAE;UACnC,MAAM,IAAIE,eAAe,CAACM,oBAAoB,CAAC;QAC/D;QACY;MACZ;IACQ,KAAK,MAAM;IACX,KAAK,UAAU;MAAE;QACb,IAAIC,KAAK;QACT,IAAI;UACAA,KAAK,GAAG,CAAC,MAAMf,OAAO,CAACW,IAAI,CAACC,gBAAgB,EAAE,EAAEI,MAAM,EAAEC,WAAW,CAACC,QAAQ,EAAE;QAC9F,CAAa,CACD,OAAOC,CAAC,EAAE;UACtB;UACgB,MAAM,IAAIX,eAAe,CAAC;YACtB,GAAGY,iBAAiB;YACpBC,eAAe,EAAEF;UACrC,CAAiB,CAAC;QAClB;QACA;QACA;QACA;QACY,IAAI,CAACJ,KAAK,EAAE;UACR,MAAM,IAAIP,eAAe,CAACc,mBAAmB,CAAC;QAC9D;QACYf,OAAO,GAAG;UACNgB,aAAa,EAAER;QAC/B,CAAa;QACD;MACZ;IACQ,KAAK,QAAQ;MACT,IAAI,OAAOZ,iBAAiB,KAAK,QAAQ,IACrC,CAACA,iBAAiB,CAACoB,aAAa,EAAE;QAClC,MAAM,IAAIf,eAAe,CAACgB,oBAAoB,CAAC;MAC/D;MACYjB,OAAO,GAAG;QACNgB,aAAa,EAAEpB,iBAAiB,CAACoB;MACjD,CAAa;MACD;EAKZ;EACI,OAAOhB,OAAO;AAClB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}