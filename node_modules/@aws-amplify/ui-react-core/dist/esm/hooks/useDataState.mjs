import { isFunction } from '@aws-amplify/ui';
import React__default from 'react';

// default state
const INITIAL_STATE = { hasError: false, isLoading: false, message: undefined };
const LOADING_STATE = { hasError: false, isLoading: true, message: undefined };
const ERROR_STATE = { hasError: true, isLoading: false };
const resolveMaybeAsync = async (value) => {
    const awaited = await value;
    return awaited;
};
function useDataState(action, initialData, options) {
    const [dataState, setDataState] = React__default.useState(() => ({
        ...INITIAL_STATE,
        data: initialData,
    }));
    const prevData = React__default.useRef(initialData);
    const { onSuccess, onError } = options ?? {};
    const handleAction = React__default.useCallback((input) => {
        setDataState(({ data }) => ({ ...LOADING_STATE, data }));
        resolveMaybeAsync(action(prevData.current, input))
            .then((data) => {
            if (isFunction(onSuccess))
                onSuccess(data);
            prevData.current = data;
            setDataState({ ...INITIAL_STATE, data });
        })
            .catch(({ message }) => {
            if (isFunction(onError))
                onError(message);
            setDataState(({ data }) => ({ ...ERROR_STATE, data, message }));
        });
    }, [action, onError, onSuccess]);
    return [dataState, handleAction];
}

export { useDataState as default };
