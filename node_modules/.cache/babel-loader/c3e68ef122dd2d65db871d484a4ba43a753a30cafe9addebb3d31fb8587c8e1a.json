{"ast":null,"code":"import { USER_AGENT_HEADER, getAmplifyUserAgent } from '@aws-amplify/core/internals/utils';\nimport { MESSAGE_TYPES, DEFAULT_KEEP_ALIVE_TIMEOUT } from '../constants.mjs';\nimport { AWSWebSocketProvider } from '../AWSWebSocketProvider/index.mjs';\nimport { awsRealTimeHeaderBasedAuth } from '../AWSWebSocketProvider/authHeaders.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst PROVIDER_NAME = 'AWSAppSyncRealTimeProvider';\nconst WS_PROTOCOL_NAME = 'graphql-ws';\nconst CONNECT_URI = '/connect';\nclass AWSAppSyncRealTimeProvider extends AWSWebSocketProvider {\n  constructor() {\n    super({\n      providerName: PROVIDER_NAME,\n      wsProtocolName: WS_PROTOCOL_NAME,\n      connectUri: CONNECT_URI\n    });\n  }\n  getProviderName() {\n    return PROVIDER_NAME;\n  }\n  subscribe(options, customUserAgentDetails) {\n    return super.subscribe(options, customUserAgentDetails);\n  }\n  async _prepareSubscriptionPayload({\n    options,\n    subscriptionId,\n    customUserAgentDetails,\n    additionalCustomHeaders,\n    libraryConfigHeaders\n  }) {\n    const {\n      appSyncGraphqlEndpoint,\n      authenticationType,\n      query,\n      variables,\n      apiKey,\n      region\n    } = options;\n    const data = {\n      query,\n      variables\n    };\n    const serializedData = JSON.stringify(data);\n    const headers = {\n      ...(await awsRealTimeHeaderBasedAuth({\n        apiKey,\n        appSyncGraphqlEndpoint,\n        authenticationType,\n        payload: serializedData,\n        canonicalUri: '',\n        region,\n        additionalCustomHeaders\n      })),\n      ...libraryConfigHeaders,\n      ...additionalCustomHeaders,\n      [USER_AGENT_HEADER]: getAmplifyUserAgent(customUserAgentDetails)\n    };\n    const subscriptionMessage = {\n      id: subscriptionId,\n      payload: {\n        data: serializedData,\n        extensions: {\n          authorization: {\n            ...headers\n          }\n        }\n      },\n      type: MESSAGE_TYPES.GQL_START\n    };\n    const serializedSubscriptionMessage = JSON.stringify(subscriptionMessage);\n    return serializedSubscriptionMessage;\n  }\n  _handleSubscriptionData(message) {\n    this.logger.debug(`subscription message from AWS AppSync RealTime: ${message.data}`);\n    const {\n      id = '',\n      payload,\n      type\n    } = JSON.parse(String(message.data));\n    const {\n      observer = null,\n      query = '',\n      variables = {}\n    } = this.subscriptionObserverMap.get(id) || {};\n    this.logger.debug({\n      id,\n      observer,\n      query,\n      variables\n    });\n    if (type === MESSAGE_TYPES.DATA && payload && payload.data) {\n      if (observer) {\n        observer.next(payload);\n      } else {\n        this.logger.debug(`observer not found for id: ${id}`);\n      }\n      return [true, {\n        id,\n        type,\n        payload\n      }];\n    }\n    return [false, {\n      id,\n      type,\n      payload\n    }];\n  }\n  _unsubscribeMessage(subscriptionId) {\n    return {\n      id: subscriptionId,\n      type: MESSAGE_TYPES.GQL_STOP\n    };\n  }\n  _extractConnectionTimeout(data) {\n    const {\n      payload: {\n        connectionTimeoutMs = DEFAULT_KEEP_ALIVE_TIMEOUT\n      } = {}\n    } = data;\n    return connectionTimeoutMs;\n  }\n  _extractErrorCodeAndType(data) {\n    const {\n      payload: {\n        errors: [{\n          errorType = '',\n          errorCode = 0\n        } = {}] = []\n      } = {}\n    } = data;\n    return {\n      errorCode,\n      errorType\n    };\n  }\n}\nexport { AWSAppSyncRealTimeProvider };","map":{"version":3,"names":["PROVIDER_NAME","WS_PROTOCOL_NAME","CONNECT_URI","AWSAppSyncRealTimeProvider","AWSWebSocketProvider","constructor","providerName","wsProtocolName","connectUri","getProviderName","subscribe","options","customUserAgentDetails","_prepareSubscriptionPayload","subscriptionId","additionalCustomHeaders","libraryConfigHeaders","appSyncGraphqlEndpoint","authenticationType","query","variables","apiKey","region","data","serializedData","JSON","stringify","headers","awsRealTimeHeaderBasedAuth","payload","canonicalUri","USER_AGENT_HEADER","getAmplifyUserAgent","subscriptionMessage","id","extensions","authorization","type","MESSAGE_TYPES","GQL_START","serializedSubscriptionMessage","_handleSubscriptionData","message","logger","debug","parse","String","observer","subscriptionObserverMap","get","DATA","next","_unsubscribeMessage","GQL_STOP","_extractConnectionTimeout","connectionTimeoutMs","DEFAULT_KEEP_ALIVE_TIMEOUT","_extractErrorCodeAndType","errors","errorType","errorCode"],"sources":["/Users/yaki/digi-coin/digi-coin-app/node_modules/@aws-amplify/api-graphql/src/Providers/AWSAppSyncRealTimeProvider/index.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { USER_AGENT_HEADER, getAmplifyUserAgent, } from '@aws-amplify/core/internals/utils';\nimport { DEFAULT_KEEP_ALIVE_TIMEOUT, MESSAGE_TYPES } from '../constants';\nimport { AWSWebSocketProvider } from '../AWSWebSocketProvider';\nimport { awsRealTimeHeaderBasedAuth } from '../AWSWebSocketProvider/authHeaders';\nconst PROVIDER_NAME = 'AWSAppSyncRealTimeProvider';\nconst WS_PROTOCOL_NAME = 'graphql-ws';\nconst CONNECT_URI = '/connect';\nexport class AWSAppSyncRealTimeProvider extends AWSWebSocketProvider {\n    constructor() {\n        super({\n            providerName: PROVIDER_NAME,\n            wsProtocolName: WS_PROTOCOL_NAME,\n            connectUri: CONNECT_URI,\n        });\n    }\n    getProviderName() {\n        return PROVIDER_NAME;\n    }\n    subscribe(options, customUserAgentDetails) {\n        return super.subscribe(options, customUserAgentDetails);\n    }\n    async _prepareSubscriptionPayload({ options, subscriptionId, customUserAgentDetails, additionalCustomHeaders, libraryConfigHeaders, }) {\n        const { appSyncGraphqlEndpoint, authenticationType, query, variables, apiKey, region, } = options;\n        const data = {\n            query,\n            variables,\n        };\n        const serializedData = JSON.stringify(data);\n        const headers = {\n            ...(await awsRealTimeHeaderBasedAuth({\n                apiKey,\n                appSyncGraphqlEndpoint,\n                authenticationType,\n                payload: serializedData,\n                canonicalUri: '',\n                region,\n                additionalCustomHeaders,\n            })),\n            ...libraryConfigHeaders,\n            ...additionalCustomHeaders,\n            [USER_AGENT_HEADER]: getAmplifyUserAgent(customUserAgentDetails),\n        };\n        const subscriptionMessage = {\n            id: subscriptionId,\n            payload: {\n                data: serializedData,\n                extensions: {\n                    authorization: {\n                        ...headers,\n                    },\n                },\n            },\n            type: MESSAGE_TYPES.GQL_START,\n        };\n        const serializedSubscriptionMessage = JSON.stringify(subscriptionMessage);\n        return serializedSubscriptionMessage;\n    }\n    _handleSubscriptionData(message) {\n        this.logger.debug(`subscription message from AWS AppSync RealTime: ${message.data}`);\n        const { id = '', payload, type } = JSON.parse(String(message.data));\n        const { observer = null, query = '', variables = {}, } = this.subscriptionObserverMap.get(id) || {};\n        this.logger.debug({ id, observer, query, variables });\n        if (type === MESSAGE_TYPES.DATA && payload && payload.data) {\n            if (observer) {\n                observer.next(payload);\n            }\n            else {\n                this.logger.debug(`observer not found for id: ${id}`);\n            }\n            return [true, { id, type, payload }];\n        }\n        return [false, { id, type, payload }];\n    }\n    _unsubscribeMessage(subscriptionId) {\n        return {\n            id: subscriptionId,\n            type: MESSAGE_TYPES.GQL_STOP,\n        };\n    }\n    _extractConnectionTimeout(data) {\n        const { payload: { connectionTimeoutMs = DEFAULT_KEEP_ALIVE_TIMEOUT } = {}, } = data;\n        return connectionTimeoutMs;\n    }\n    _extractErrorCodeAndType(data) {\n        const { payload: { errors: [{ errorType = '', errorCode = 0 } = {}] = [] } = {}, } = data;\n        return { errorCode, errorType };\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}