{"ast":null,"code":"import { HubInternal } from '@aws-amplify/core/internals/utils';\nimport { signIn } from '../apis/signIn.mjs';\nimport { AuthError } from '../../../errors/AuthError.mjs';\nimport { setAutoSignIn, resetAutoSignIn } from '../apis/autoSignIn.mjs';\nimport { AUTO_SIGN_IN_EXCEPTION } from '../../../errors/constants.mjs';\nimport { signInWithUserAuth } from '../apis/signInWithUserAuth.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst MAX_AUTOSIGNIN_POLLING_MS = 3 * 60 * 1000;\nfunction handleCodeAutoSignIn(signInInput) {\n  const stopHubListener = HubInternal.listen('auth-internal', async _ref => {\n    let {\n      payload\n    } = _ref;\n    switch (payload.event) {\n      case 'confirmSignUp':\n        {\n          const response = payload.data;\n          if (response?.isSignUpComplete) {\n            HubInternal.dispatch('auth-internal', {\n              event: 'autoSignIn'\n            });\n            setAutoSignIn(autoSignInWithCode(signInInput));\n            stopHubListener();\n          }\n        }\n    }\n  });\n  // This will stop the listener if confirmSignUp is not resolved.\n  const timeOutId = setTimeout(() => {\n    stopHubListener();\n    clearTimeout(timeOutId);\n    resetAutoSignIn();\n  }, MAX_AUTOSIGNIN_POLLING_MS);\n}\nfunction debounce(fun, delay) {\n  let timer;\n  return args => {\n    if (!timer) {\n      fun(...args);\n    }\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      timer = undefined;\n    }, delay);\n  };\n}\nfunction handleAutoSignInWithLink(signInInput, resolve, reject) {\n  const start = Date.now();\n  const autoSignInPollingIntervalId = setInterval(async () => {\n    const elapsedTime = Date.now() - start;\n    const maxTime = MAX_AUTOSIGNIN_POLLING_MS;\n    if (elapsedTime > maxTime) {\n      clearInterval(autoSignInPollingIntervalId);\n      reject(new AuthError({\n        name: AUTO_SIGN_IN_EXCEPTION,\n        message: 'The account was not confirmed on time.',\n        recoverySuggestion: 'Try to verify your account by clicking the link sent your email or phone and then login manually.'\n      }));\n      resetAutoSignIn();\n    } else {\n      try {\n        const signInOutput = await signIn(signInInput);\n        if (signInOutput.nextStep.signInStep !== 'CONFIRM_SIGN_UP') {\n          resolve(signInOutput);\n          clearInterval(autoSignInPollingIntervalId);\n          resetAutoSignIn();\n        }\n      } catch (error) {\n        clearInterval(autoSignInPollingIntervalId);\n        reject(error);\n        resetAutoSignIn();\n      }\n    }\n  }, 5000);\n}\nconst debouncedAutoSignInWithLink = debounce(handleAutoSignInWithLink, 300);\nconst debouncedAutoSignWithCodeOrUserConfirmed = debounce(handleAutoSignInWithCodeOrUserConfirmed, 300);\nfunction autoSignInWhenUserIsConfirmedWithLink(signInInput) {\n  return async () => {\n    return new Promise((resolve, reject) => {\n      debouncedAutoSignInWithLink([signInInput, resolve, reject]);\n    });\n  };\n}\nasync function handleAutoSignInWithCodeOrUserConfirmed(signInInput, resolve, reject) {\n  try {\n    const output = signInInput?.options?.authFlowType === 'USER_AUTH' ? await signInWithUserAuth(signInInput) : await signIn(signInInput);\n    resolve(output);\n    resetAutoSignIn();\n  } catch (error) {\n    reject(error);\n    resetAutoSignIn();\n  }\n}\nfunction autoSignInWithCode(signInInput) {\n  return async () => {\n    return new Promise((resolve, reject) => {\n      debouncedAutoSignWithCodeOrUserConfirmed([signInInput, resolve, reject]);\n    });\n  };\n}\nconst autoSignInUserConfirmed = autoSignInWithCode;\nexport { autoSignInUserConfirmed, autoSignInWhenUserIsConfirmedWithLink, handleCodeAutoSignIn };","map":{"version":3,"names":["MAX_AUTOSIGNIN_POLLING_MS","handleCodeAutoSignIn","signInInput","stopHubListener","HubInternal","listen","_ref","payload","event","response","data","isSignUpComplete","dispatch","setAutoSignIn","autoSignInWithCode","timeOutId","setTimeout","clearTimeout","resetAutoSignIn","debounce","fun","delay","timer","args","undefined","handleAutoSignInWithLink","resolve","reject","start","Date","now","autoSignInPollingIntervalId","setInterval","elapsedTime","maxTime","clearInterval","AuthError","name","AUTO_SIGN_IN_EXCEPTION","message","recoverySuggestion","signInOutput","signIn","nextStep","signInStep","error","debouncedAutoSignInWithLink","debouncedAutoSignWithCodeOrUserConfirmed","handleAutoSignInWithCodeOrUserConfirmed","autoSignInWhenUserIsConfirmedWithLink","Promise","output","options","authFlowType","signInWithUserAuth","autoSignInUserConfirmed"],"sources":["/Users/yaki/digi-coin/digi-coin-app/node_modules/@aws-amplify/auth/src/providers/cognito/utils/signUpHelpers.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { HubInternal } from '@aws-amplify/core/internals/utils';\nimport { signIn } from '../apis/signIn';\nimport { AuthError } from '../../../errors/AuthError';\nimport { resetAutoSignIn, setAutoSignIn } from '../apis/autoSignIn';\nimport { AUTO_SIGN_IN_EXCEPTION } from '../../../errors/constants';\nimport { signInWithUserAuth } from '../apis/signInWithUserAuth';\nconst MAX_AUTOSIGNIN_POLLING_MS = 3 * 60 * 1000;\nexport function handleCodeAutoSignIn(signInInput) {\n    const stopHubListener = HubInternal.listen('auth-internal', async ({ payload }) => {\n        switch (payload.event) {\n            case 'confirmSignUp': {\n                const response = payload.data;\n                if (response?.isSignUpComplete) {\n                    HubInternal.dispatch('auth-internal', {\n                        event: 'autoSignIn',\n                    });\n                    setAutoSignIn(autoSignInWithCode(signInInput));\n                    stopHubListener();\n                }\n            }\n        }\n    });\n    // This will stop the listener if confirmSignUp is not resolved.\n    const timeOutId = setTimeout(() => {\n        stopHubListener();\n        clearTimeout(timeOutId);\n        resetAutoSignIn();\n    }, MAX_AUTOSIGNIN_POLLING_MS);\n}\nfunction debounce(fun, delay) {\n    let timer;\n    return (args) => {\n        if (!timer) {\n            fun(...args);\n        }\n        clearTimeout(timer);\n        timer = setTimeout(() => {\n            timer = undefined;\n        }, delay);\n    };\n}\nfunction handleAutoSignInWithLink(signInInput, resolve, reject) {\n    const start = Date.now();\n    const autoSignInPollingIntervalId = setInterval(async () => {\n        const elapsedTime = Date.now() - start;\n        const maxTime = MAX_AUTOSIGNIN_POLLING_MS;\n        if (elapsedTime > maxTime) {\n            clearInterval(autoSignInPollingIntervalId);\n            reject(new AuthError({\n                name: AUTO_SIGN_IN_EXCEPTION,\n                message: 'The account was not confirmed on time.',\n                recoverySuggestion: 'Try to verify your account by clicking the link sent your email or phone and then login manually.',\n            }));\n            resetAutoSignIn();\n        }\n        else {\n            try {\n                const signInOutput = await signIn(signInInput);\n                if (signInOutput.nextStep.signInStep !== 'CONFIRM_SIGN_UP') {\n                    resolve(signInOutput);\n                    clearInterval(autoSignInPollingIntervalId);\n                    resetAutoSignIn();\n                }\n            }\n            catch (error) {\n                clearInterval(autoSignInPollingIntervalId);\n                reject(error);\n                resetAutoSignIn();\n            }\n        }\n    }, 5000);\n}\nconst debouncedAutoSignInWithLink = debounce(handleAutoSignInWithLink, 300);\nconst debouncedAutoSignWithCodeOrUserConfirmed = debounce(handleAutoSignInWithCodeOrUserConfirmed, 300);\nexport function autoSignInWhenUserIsConfirmedWithLink(signInInput) {\n    return async () => {\n        return new Promise((resolve, reject) => {\n            debouncedAutoSignInWithLink([signInInput, resolve, reject]);\n        });\n    };\n}\nasync function handleAutoSignInWithCodeOrUserConfirmed(signInInput, resolve, reject) {\n    try {\n        const output = signInInput?.options?.authFlowType === 'USER_AUTH'\n            ? await signInWithUserAuth(signInInput)\n            : await signIn(signInInput);\n        resolve(output);\n        resetAutoSignIn();\n    }\n    catch (error) {\n        reject(error);\n        resetAutoSignIn();\n    }\n}\nfunction autoSignInWithCode(signInInput) {\n    return async () => {\n        return new Promise((resolve, reject) => {\n            debouncedAutoSignWithCodeOrUserConfirmed([signInInput, resolve, reject]);\n        });\n    };\n}\nexport const autoSignInUserConfirmed = autoSignInWithCode;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}