{"ast":null,"code":"import { getClientInfo } from '../../../utils/getClientInfo/getClientInfo.mjs';\nimport '../../../utils/retry/retry.mjs';\nimport '../../../types/errors.mjs';\nimport '@aws-crypto/sha256-js';\nimport '@smithy/util-hex-encoding';\nimport '../../../errors/errorHelpers.mjs';\nimport '../../../awsClients/pinpoint/base.mjs';\nimport '../../../awsClients/pinpoint/errorHelpers.mjs';\nimport { updateEndpoint as updateEndpoint$1 } from '../../../awsClients/pinpoint/updateEndpoint.mjs';\nimport { amplifyUuid } from '../../../utils/amplifyUuid/index.mjs';\nimport { cacheEndpointId } from '../utils/cacheEndpointId.mjs';\nimport { createEndpointId, clearCreatedEndpointId } from '../utils/createEndpointId.mjs';\nimport { getEndpointId } from '../utils/getEndpointId.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * @internal\n */\nconst updateEndpoint = async _ref => {\n  let {\n    address,\n    appId,\n    category,\n    channelType,\n    credentials,\n    identityId,\n    optOut,\n    region,\n    userAttributes,\n    userId,\n    userProfile,\n    userAgentValue\n  } = _ref;\n  const endpointId = await getEndpointId(appId, category);\n  // only generate a new endpoint id if one was not found in cache\n  const createdEndpointId = !endpointId ? createEndpointId(appId, category) : undefined;\n  const {\n    customProperties,\n    demographic,\n    email,\n    location,\n    metrics,\n    name,\n    plan\n  } = userProfile ?? {};\n  // only automatically populate the endpoint with client info and identity id upon endpoint creation to\n  // avoid overwriting the endpoint with these values every time the endpoint is updated\n  const demographicsFromClientInfo = {};\n  const resolvedUserId = createdEndpointId ? userId ?? identityId : userId;\n  if (createdEndpointId) {\n    const clientInfo = getClientInfo();\n    demographicsFromClientInfo.appVersion = clientInfo.appVersion;\n    demographicsFromClientInfo.make = clientInfo.make;\n    demographicsFromClientInfo.model = clientInfo.model;\n    demographicsFromClientInfo.modelVersion = clientInfo.version;\n    demographicsFromClientInfo.platform = clientInfo.platform;\n  }\n  const mergedDemographic = {\n    ...demographicsFromClientInfo,\n    ...demographic\n  };\n  const attributes = {\n    ...(email && {\n      email: [email]\n    }),\n    ...(name && {\n      name: [name]\n    }),\n    ...(plan && {\n      plan: [plan]\n    }),\n    ...customProperties\n  };\n  const shouldAddDemographics = createdEndpointId || demographic;\n  const shouldAddAttributes = email || customProperties || name || plan;\n  const shouldAddUser = resolvedUserId || userAttributes;\n  const input = {\n    ApplicationId: appId,\n    EndpointId: endpointId ?? createdEndpointId,\n    EndpointRequest: {\n      RequestId: amplifyUuid(),\n      EffectiveDate: new Date().toISOString(),\n      ChannelType: channelType,\n      Address: address,\n      ...(shouldAddAttributes && {\n        Attributes: attributes\n      }),\n      ...(shouldAddDemographics && {\n        Demographic: {\n          AppVersion: mergedDemographic.appVersion,\n          Locale: mergedDemographic.locale,\n          Make: mergedDemographic.make,\n          Model: mergedDemographic.model,\n          ModelVersion: mergedDemographic.modelVersion,\n          Platform: mergedDemographic.platform,\n          PlatformVersion: mergedDemographic.platformVersion,\n          Timezone: mergedDemographic.timezone\n        }\n      }),\n      ...(location && {\n        Location: {\n          City: location.city,\n          Country: location.country,\n          Latitude: location.latitude,\n          Longitude: location.longitude,\n          PostalCode: location.postalCode,\n          Region: location.region\n        }\n      }),\n      Metrics: metrics,\n      OptOut: optOut,\n      ...(shouldAddUser && {\n        User: {\n          UserId: resolvedUserId,\n          UserAttributes: userAttributes\n        }\n      })\n    }\n  };\n  try {\n    await updateEndpoint$1({\n      credentials,\n      region,\n      userAgentValue\n    }, input);\n    // if we had to create an endpoint id, we need to now cache it\n    if (createdEndpointId) {\n      await cacheEndpointId(appId, category, createdEndpointId);\n    }\n  } finally {\n    // at this point, we completely reset the behavior so even if the update was unsuccessful\n    // we can just start over with a newly created endpoint id\n    if (createdEndpointId) {\n      clearCreatedEndpointId(appId, category);\n    }\n  }\n};\nexport { updateEndpoint };","map":{"version":3,"names":["updateEndpoint","_ref","address","appId","category","channelType","credentials","identityId","optOut","region","userAttributes","userId","userProfile","userAgentValue","endpointId","getEndpointId","createdEndpointId","createEndpointId","undefined","customProperties","demographic","email","location","metrics","name","plan","demographicsFromClientInfo","resolvedUserId","clientInfo","getClientInfo","appVersion","make","model","modelVersion","version","platform","mergedDemographic","attributes","shouldAddDemographics","shouldAddAttributes","shouldAddUser","input","ApplicationId","EndpointId","EndpointRequest","RequestId","amplifyUuid","EffectiveDate","Date","toISOString","ChannelType","Address","Attributes","Demographic","AppVersion","Locale","locale","Make","Model","ModelVersion","Platform","PlatformVersion","platformVersion","Timezone","timezone","Location","City","city","Country","country","Latitude","latitude","Longitude","longitude","PostalCode","postalCode","Region","Metrics","OptOut","User","UserId","UserAttributes","updateEndpoint$1","cacheEndpointId","clearCreatedEndpointId"],"sources":["/Users/yaki/digi-coin/digi-coin-app/node_modules/@aws-amplify/core/src/providers/pinpoint/apis/updateEndpoint.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { updateEndpoint as clientUpdateEndpoint, } from '../../../awsClients/pinpoint';\nimport { amplifyUuid } from '../../../utils/amplifyUuid';\nimport { getClientInfo } from '../../../utils/getClientInfo';\nimport { cacheEndpointId } from '../utils/cacheEndpointId';\nimport { clearCreatedEndpointId, createEndpointId, } from '../utils/createEndpointId';\nimport { getEndpointId } from '../utils/getEndpointId';\n/**\n * @internal\n */\nexport const updateEndpoint = async ({ address, appId, category, channelType, credentials, identityId, optOut, region, userAttributes, userId, userProfile, userAgentValue, }) => {\n    const endpointId = await getEndpointId(appId, category);\n    // only generate a new endpoint id if one was not found in cache\n    const createdEndpointId = !endpointId\n        ? createEndpointId(appId, category)\n        : undefined;\n    const { customProperties, demographic, email, location, metrics, name, plan, } = userProfile ?? {};\n    // only automatically populate the endpoint with client info and identity id upon endpoint creation to\n    // avoid overwriting the endpoint with these values every time the endpoint is updated\n    const demographicsFromClientInfo = {};\n    const resolvedUserId = createdEndpointId ? (userId ?? identityId) : userId;\n    if (createdEndpointId) {\n        const clientInfo = getClientInfo();\n        demographicsFromClientInfo.appVersion = clientInfo.appVersion;\n        demographicsFromClientInfo.make = clientInfo.make;\n        demographicsFromClientInfo.model = clientInfo.model;\n        demographicsFromClientInfo.modelVersion = clientInfo.version;\n        demographicsFromClientInfo.platform = clientInfo.platform;\n    }\n    const mergedDemographic = {\n        ...demographicsFromClientInfo,\n        ...demographic,\n    };\n    const attributes = {\n        ...(email && { email: [email] }),\n        ...(name && { name: [name] }),\n        ...(plan && { plan: [plan] }),\n        ...customProperties,\n    };\n    const shouldAddDemographics = createdEndpointId || demographic;\n    const shouldAddAttributes = email || customProperties || name || plan;\n    const shouldAddUser = resolvedUserId || userAttributes;\n    const input = {\n        ApplicationId: appId,\n        EndpointId: endpointId ?? createdEndpointId,\n        EndpointRequest: {\n            RequestId: amplifyUuid(),\n            EffectiveDate: new Date().toISOString(),\n            ChannelType: channelType,\n            Address: address,\n            ...(shouldAddAttributes && { Attributes: attributes }),\n            ...(shouldAddDemographics && {\n                Demographic: {\n                    AppVersion: mergedDemographic.appVersion,\n                    Locale: mergedDemographic.locale,\n                    Make: mergedDemographic.make,\n                    Model: mergedDemographic.model,\n                    ModelVersion: mergedDemographic.modelVersion,\n                    Platform: mergedDemographic.platform,\n                    PlatformVersion: mergedDemographic.platformVersion,\n                    Timezone: mergedDemographic.timezone,\n                },\n            }),\n            ...(location && {\n                Location: {\n                    City: location.city,\n                    Country: location.country,\n                    Latitude: location.latitude,\n                    Longitude: location.longitude,\n                    PostalCode: location.postalCode,\n                    Region: location.region,\n                },\n            }),\n            Metrics: metrics,\n            OptOut: optOut,\n            ...(shouldAddUser && {\n                User: {\n                    UserId: resolvedUserId,\n                    UserAttributes: userAttributes,\n                },\n            }),\n        },\n    };\n    try {\n        await clientUpdateEndpoint({ credentials, region, userAgentValue }, input);\n        // if we had to create an endpoint id, we need to now cache it\n        if (createdEndpointId) {\n            await cacheEndpointId(appId, category, createdEndpointId);\n        }\n    }\n    finally {\n        // at this point, we completely reset the behavior so even if the update was unsuccessful\n        // we can just start over with a newly created endpoint id\n        if (createdEndpointId) {\n            clearCreatedEndpointId(appId, category);\n        }\n    }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}