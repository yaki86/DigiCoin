{"ast":null,"code":"import { ConsoleLogger, Amplify, clearCredentials, Hub, defaultStorage } from '@aws-amplify/core';\nimport { assertTokenProviderConfig, assertOAuthConfig, AMPLIFY_SYMBOL, AuthAction } from '@aws-amplify/core/internals/utils';\nimport { getAuthUserAgentValue } from '../../../utils/getAuthUserAgentValue.mjs';\nimport '../utils/refreshAuthTokens.mjs';\nimport { AuthError } from '../../../errors/AuthError.mjs';\nimport '../tokenProvider/errorHelpers.mjs';\nimport { DefaultOAuthStore } from '../utils/signInWithRedirectStore.mjs';\nimport { tokenOrchestrator } from '../tokenProvider/tokenProvider.mjs';\nimport { getRegionFromUserPoolId } from '../../../foundation/parsers/regionParsers.mjs';\nimport { assertAuthTokensWithRefreshToken, assertAuthTokens } from '../utils/types.mjs';\nimport '@aws-crypto/sha256-js';\nimport { handleOAuthSignOut } from '../utils/oauth/handleOAuthSignOut.mjs';\nimport { OAUTH_SIGNOUT_EXCEPTION } from '../../../errors/constants.mjs';\nimport '../../../Errors.mjs';\nimport '../../../common/AuthErrorStrings.mjs';\nimport '../../../types/Auth.mjs';\nimport '@aws-amplify/core/internals/aws-client-utils/composers';\nimport '@aws-amplify/core/internals/aws-client-utils';\nimport '../../../foundation/factories/serviceClients/cognitoIdentityProvider/shared/handler/cognitoUserPoolTransferHandler.mjs';\nimport '../../../foundation/factories/serviceClients/cognitoIdentityProvider/constants.mjs';\nimport { createRevokeTokenClient } from '../../../foundation/factories/serviceClients/cognitoIdentityProvider/createRevokeTokenClient.mjs';\nimport '../../../errors/types/validation.mjs';\nimport '../types/errors.mjs';\nimport { createGlobalSignOutClient } from '../../../foundation/factories/serviceClients/cognitoIdentityProvider/createGlobalSignOutClient.mjs';\nimport { createCognitoUserPoolEndpointResolver } from '../factories/createCognitoUserPoolEndpointResolver.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst logger = new ConsoleLogger('Auth');\n/**\n * Signs a user out\n *\n * @param input - The SignOutInput object\n * @throws AuthTokenConfigException - Thrown when the token provider config is invalid.\n */\nasync function signOut(input) {\n  const cognitoConfig = Amplify.getConfig().Auth?.Cognito;\n  assertTokenProviderConfig(cognitoConfig);\n  if (input?.global) {\n    await globalSignOut(cognitoConfig);\n  } else {\n    await clientSignOut(cognitoConfig);\n  }\n  let hasOAuthConfig;\n  try {\n    assertOAuthConfig(cognitoConfig);\n    hasOAuthConfig = true;\n  } catch (err) {\n    hasOAuthConfig = false;\n  }\n  if (hasOAuthConfig) {\n    const oAuthStore = new DefaultOAuthStore(defaultStorage);\n    oAuthStore.setAuthConfig(cognitoConfig);\n    const {\n      type\n    } = (await handleOAuthSignOut(cognitoConfig, oAuthStore, tokenOrchestrator, input?.oauth?.redirectUrl)) ?? {};\n    if (type === 'error') {\n      throw new AuthError({\n        name: OAUTH_SIGNOUT_EXCEPTION,\n        message: `An error occurred when attempting to log out from OAuth provider.`\n      });\n    }\n  } else {\n    // complete sign out\n    tokenOrchestrator.clearTokens();\n    await clearCredentials();\n    Hub.dispatch('auth', {\n      event: 'signedOut'\n    }, 'Auth', AMPLIFY_SYMBOL);\n  }\n}\nasync function clientSignOut(cognitoConfig) {\n  try {\n    const {\n      userPoolEndpoint,\n      userPoolId,\n      userPoolClientId\n    } = cognitoConfig;\n    const authTokens = await tokenOrchestrator.getTokenStore().loadTokens();\n    assertAuthTokensWithRefreshToken(authTokens);\n    if (isSessionRevocable(authTokens.accessToken)) {\n      const revokeToken = createRevokeTokenClient({\n        endpointResolver: createCognitoUserPoolEndpointResolver({\n          endpointOverride: userPoolEndpoint\n        })\n      });\n      await revokeToken({\n        region: getRegionFromUserPoolId(userPoolId),\n        userAgentValue: getAuthUserAgentValue(AuthAction.SignOut)\n      }, {\n        ClientId: userPoolClientId,\n        Token: authTokens.refreshToken\n      });\n    }\n  } catch (err) {\n    // this shouldn't throw\n    logger.debug('Client signOut error caught but will proceed with token removal');\n  }\n}\nasync function globalSignOut(cognitoConfig) {\n  try {\n    const {\n      userPoolEndpoint,\n      userPoolId\n    } = cognitoConfig;\n    const authTokens = await tokenOrchestrator.getTokenStore().loadTokens();\n    assertAuthTokens(authTokens);\n    const globalSignOutClient = createGlobalSignOutClient({\n      endpointResolver: createCognitoUserPoolEndpointResolver({\n        endpointOverride: userPoolEndpoint\n      })\n    });\n    await globalSignOutClient({\n      region: getRegionFromUserPoolId(userPoolId),\n      userAgentValue: getAuthUserAgentValue(AuthAction.SignOut)\n    }, {\n      AccessToken: authTokens.accessToken.toString()\n    });\n  } catch (err) {\n    // it should not throw\n    logger.debug('Global signOut error caught but will proceed with token removal');\n  }\n}\nconst isSessionRevocable = token => !!token?.payload?.origin_jti;\nexport { signOut };","map":{"version":3,"names":["logger","ConsoleLogger","signOut","input","cognitoConfig","Amplify","getConfig","Auth","Cognito","assertTokenProviderConfig","global","globalSignOut","clientSignOut","hasOAuthConfig","assertOAuthConfig","err","oAuthStore","DefaultOAuthStore","defaultStorage","setAuthConfig","type","handleOAuthSignOut","tokenOrchestrator","oauth","redirectUrl","AuthError","name","OAUTH_SIGNOUT_EXCEPTION","message","clearTokens","clearCredentials","Hub","dispatch","event","AMPLIFY_SYMBOL","userPoolEndpoint","userPoolId","userPoolClientId","authTokens","getTokenStore","loadTokens","assertAuthTokensWithRefreshToken","isSessionRevocable","accessToken","revokeToken","createRevokeTokenClient","endpointResolver","createCognitoUserPoolEndpointResolver","endpointOverride","region","getRegionFromUserPoolId","userAgentValue","getAuthUserAgentValue","AuthAction","SignOut","ClientId","Token","refreshToken","debug","assertAuthTokens","globalSignOutClient","createGlobalSignOutClient","AccessToken","toString","token","payload","origin_jti"],"sources":["/Users/yaki/digi-coin/digi-coin-app/node_modules/@aws-amplify/auth/src/providers/cognito/apis/signOut.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { Amplify, ConsoleLogger, Hub, clearCredentials, defaultStorage, } from '@aws-amplify/core';\nimport { AMPLIFY_SYMBOL, AuthAction, assertOAuthConfig, assertTokenProviderConfig, } from '@aws-amplify/core/internals/utils';\nimport { getAuthUserAgentValue } from '../../../utils';\nimport { tokenOrchestrator } from '../tokenProvider';\nimport { getRegionFromUserPoolId } from '../../../foundation/parsers';\nimport { assertAuthTokens, assertAuthTokensWithRefreshToken, } from '../utils/types';\nimport { handleOAuthSignOut } from '../utils/oauth';\nimport { DefaultOAuthStore } from '../utils/signInWithRedirectStore';\nimport { AuthError } from '../../../errors/AuthError';\nimport { OAUTH_SIGNOUT_EXCEPTION } from '../../../errors/constants';\nimport { createGlobalSignOutClient, createRevokeTokenClient, } from '../../../foundation/factories/serviceClients/cognitoIdentityProvider';\nimport { createCognitoUserPoolEndpointResolver } from '../factories';\nconst logger = new ConsoleLogger('Auth');\n/**\n * Signs a user out\n *\n * @param input - The SignOutInput object\n * @throws AuthTokenConfigException - Thrown when the token provider config is invalid.\n */\nexport async function signOut(input) {\n    const cognitoConfig = Amplify.getConfig().Auth?.Cognito;\n    assertTokenProviderConfig(cognitoConfig);\n    if (input?.global) {\n        await globalSignOut(cognitoConfig);\n    }\n    else {\n        await clientSignOut(cognitoConfig);\n    }\n    let hasOAuthConfig;\n    try {\n        assertOAuthConfig(cognitoConfig);\n        hasOAuthConfig = true;\n    }\n    catch (err) {\n        hasOAuthConfig = false;\n    }\n    if (hasOAuthConfig) {\n        const oAuthStore = new DefaultOAuthStore(defaultStorage);\n        oAuthStore.setAuthConfig(cognitoConfig);\n        const { type } = (await handleOAuthSignOut(cognitoConfig, oAuthStore, tokenOrchestrator, input?.oauth?.redirectUrl)) ?? {};\n        if (type === 'error') {\n            throw new AuthError({\n                name: OAUTH_SIGNOUT_EXCEPTION,\n                message: `An error occurred when attempting to log out from OAuth provider.`,\n            });\n        }\n    }\n    else {\n        // complete sign out\n        tokenOrchestrator.clearTokens();\n        await clearCredentials();\n        Hub.dispatch('auth', { event: 'signedOut' }, 'Auth', AMPLIFY_SYMBOL);\n    }\n}\nasync function clientSignOut(cognitoConfig) {\n    try {\n        const { userPoolEndpoint, userPoolId, userPoolClientId } = cognitoConfig;\n        const authTokens = await tokenOrchestrator.getTokenStore().loadTokens();\n        assertAuthTokensWithRefreshToken(authTokens);\n        if (isSessionRevocable(authTokens.accessToken)) {\n            const revokeToken = createRevokeTokenClient({\n                endpointResolver: createCognitoUserPoolEndpointResolver({\n                    endpointOverride: userPoolEndpoint,\n                }),\n            });\n            await revokeToken({\n                region: getRegionFromUserPoolId(userPoolId),\n                userAgentValue: getAuthUserAgentValue(AuthAction.SignOut),\n            }, {\n                ClientId: userPoolClientId,\n                Token: authTokens.refreshToken,\n            });\n        }\n    }\n    catch (err) {\n        // this shouldn't throw\n        logger.debug('Client signOut error caught but will proceed with token removal');\n    }\n}\nasync function globalSignOut(cognitoConfig) {\n    try {\n        const { userPoolEndpoint, userPoolId } = cognitoConfig;\n        const authTokens = await tokenOrchestrator.getTokenStore().loadTokens();\n        assertAuthTokens(authTokens);\n        const globalSignOutClient = createGlobalSignOutClient({\n            endpointResolver: createCognitoUserPoolEndpointResolver({\n                endpointOverride: userPoolEndpoint,\n            }),\n        });\n        await globalSignOutClient({\n            region: getRegionFromUserPoolId(userPoolId),\n            userAgentValue: getAuthUserAgentValue(AuthAction.SignOut),\n        }, {\n            AccessToken: authTokens.accessToken.toString(),\n        });\n    }\n    catch (err) {\n        // it should not throw\n        logger.debug('Global signOut error caught but will proceed with token removal');\n    }\n}\nconst isSessionRevocable = (token) => !!token?.payload?.origin_jti;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}